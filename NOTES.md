# Notes

## 5 Jan 26

### Webview Vue App Loading Issue

**Problem:**
The Vue application built for the webview was failing to load.

1.  Initially, the webview was blank because the HTML content was not being processed to replace local file paths (like `./assets/index.js`) with VS Code's special `vscode-webview-resource:` URIs.
2.  After fixing the URI replacement, the app still failed to load (silently or with CSP errors) because the Content Security Policy (CSP) was too restrictive. It blocked the loading of JavaScript chunks generated by Vite/Rollup (dynamic imports) because the `script-src` directive only allowed a specific `nonce` but not the extension's resource scheme.

**Solution:**

1.  Updated `extension/src/utils/webview-content.ts` to dynamically parse the HTML, generate a nonce, and inject a strict CSP meta tag.
2.  Updated the CSP `script-src` directive to include `${webview.cspSource}`. This allows the webview to load scripts from the extension's installation directory (which is where the Vue build assets live), enabling dynamic imports to work correctly.
3.  Updated `time-analytics-webview/src/router/index.ts` to create a web hash history.

**Final CSP:**

```html
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}' ${webview.cspSource}; img-src ${webview.cspSource} https: data:; font-src ${webview.cspSource};"
/>
```
